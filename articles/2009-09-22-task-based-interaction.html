<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Domain Task-Based Interaction | Eben Roux</title>
    <meta name="description" content="All in a golden afternoon">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.C342PWRM.css" as="style">
    
    <script type="module" src="/assets/app.Bqr9e_wV.js"></script>
    <link rel="modulepreload" href="/assets/chunks/theme.DA1ScVb5.js">
    <link rel="modulepreload" href="/assets/chunks/framework.B9tkazSO.js">
    <link rel="modulepreload" href="/assets/articles_2009-09-22-task-based-interaction.md.DqEgMml9.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="antialiased dark:bg-slate-900"><div class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><nav class="flex justify-between items-center py-10 font-bold"><a class="text-xl" href="/" aria-label="The Vue Point"><img class="inline-block mr-2 w-10 h-10 rounded-full" alt="logo" src="https://www.gravatar.com/avatar/b7e03f86009c412446cfa81cbe5c000009ffb67ec7585806aee387294e27d023?s=80&amp;d=identicon"><span class="hidden md:inline dark:text-white">Eben Roux</span></a><div class="text-sm text-gray-500 dark:text-white leading-5 flex items-center"><a class="hover:text-gray-700 dark:hover:text-gray-200" href="/books/hard-edges" rel="noopener">Hard Edges</a><span class="mr-2 ml-2">·</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://www.pendel.co.za/" target="_blank" rel="noopener">Shuttle</a><span class="mr-2 ml-2">·</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="/Eben Roux - Resume.pdf" target="_blank" rel="noopener">Resume</a><span class="mr-2 ml-2">·</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://discord.gg/QypKQP4ABq" target="_blank" rel="noopener"><svg class="fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 146 146"><title>Discord</title><path d="M107.75 125.001s-4.5-5.375-8.25-10.125c16.375-4.625 22.625-14.875 22.625-14.875-5.125 3.375-10 5.75-14.375 7.375-6.25 2.625-12.25 4.375-18.125 5.375-12 2.25-23 1.625-32.375-.125-7.125-1.375-13.25-3.375-18.375-5.375-2.875-1.125-6-2.5-9.125-4.25-.375-.25-.75-.375-1.125-.625-.25-.125-.375-.25-.5-.375-2.25-1.25-3.5-2.125-3.5-2.125s6 10 21.875 14.75c-3.75 4.75-8.375 10.375-8.375 10.375-27.625-.875-38.125-19-38.125-19 0-40.25 18-72.875 18-72.875 18-13.5 35.125-13.125 35.125-13.125l1.25 1.5c-22.5 6.5-32.875 16.375-32.875 16.375s2.75-1.5 7.375-3.625c13.375-5.875 24-7.5 28.375-7.875.75-.125 1.375-.25 2.125-.25 7.625-1 16.25-1.25 25.25-.25 11.875 1.375 24.625 4.875 37.625 12 0 0-9.875-9.375-31.125-15.875l1.75-2S110 19.626 128 33.126c0 0 18 32.625 18 72.875 0 0-10.625 18.125-38.25 19zM49.625 66.626c-7.125 0-12.75 6.25-12.75 13.875s5.75 13.875 12.75 13.875c7.125 0 12.75-6.25 12.75-13.875.125-7.625-5.625-13.875-12.75-13.875zm45.625 0c-7.125 0-12.75 6.25-12.75 13.875s5.75 13.875 12.75 13.875c7.125 0 12.75-6.25 12.75-13.875s-5.625-13.875-12.75-13.875z" fill-rule="nonzero"></path></svg></a><span class="mr-2"></span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://github.com/eben-roux/blog" target="_blank" rel="noopener"><svg class="inline fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>GitHub</title><path d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"></path></svg></a></div></nav></div><main class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><article class="xl:divide-y xl:divide-gray-200 dark:xl:divide-slate-200/5"><header class="pt-6 xl:pb-10 space-y-1 text-center"><dl><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-500 dark:text-gray-300"><time datetime="2009-09-22T12:00:00.000Z">September 22, 2009</time></dd></dl><h1 class="text-3xl leading-9 font-extrabold text-gray-900 dark:text-white tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Domain Task-Based Interaction</h1></header><div class="divide-y xl:divide-y-0 divide-gray-200 dark:divide-slate-200/5 xl:grid xl:grid-cols-4 xl:gap-x-10 pb-16 xl:pb-20" style="grid-template-rows:auto 1fr;"><!----><div class="divide-y divide-gray-200 dark:divide-slate-200/5 xl:pb-0 xl:col-span-3 xl:row-span-2"><div style="position:relative;" class="prose dark:prose-invert max-w-none pt-10 pb-8"><div><p>After some interesting to-and-froing on the Domain-Driven Design Yahoo group the penny dropped on task-based interaction. Now this is something <a href="http://www.udidahan.com">Udi Dahan</a> seems to have been doing a while and it is actually <em>very</em> nifty. I must admit that I thought I actually understood task-based vs. entity based interaction but it turns out that even having something like &#39;Activate Account&#39; is not necessarily task-based. Well, the UI would appear to be task-based to the user but how we implement this &#39;task&#39; in the domain is where it gets interesting.</p><hr><p>For our scenario we will use a disconnected environment as is the case with any real-world software solution.</p><h3 id="entity-based-implementation" tabindex="-1">Entity-based implementation <a class="header-anchor" href="#entity-based-implementation" aria-label="Permalink to &quot;Entity-based implementation&quot;">​</a></h3><p>The &#39;typical&#39; way database interaction takes place, and the way I for one have been doing this, is as follows: The user invokes the &#39;Activate Account&#39; function through some menu. The account is loaded from the table and all the account data is returned to the client. The user then enters, say, the activation date and clicks the &#39;Save&#39; button.</p><p>Now all this data goes back to the server. An update is issued and all the account data is overwritten for the relevant row. &quot;But wait!&quot; come the cries. What if some other user has updated the banking details? No problem; we simply add an incrementing RowVersion on the record to indicate whether there is a concurrency violation. Now here is an interesting bit. Typically (well I used to do it like this), we simply <em>reload</em> the record and have the user do their action again. This time the last RowVersion will come along for the ride and hopefully no other user gets to submit their data before we hit the server. All is well.</p><h3 id="task-based-implementation" tabindex="-1">Task-based implementation <a class="header-anchor" href="#task-based-implementation" aria-label="Permalink to &quot;Task-based implementation&quot;">​</a></h3><p>Using the task-based approach the user would invoke the &#39;Activate Account&#39; function. The relevant data is retrieved from the database and displayed. Once again the user enters the activation date and clicks the &#39;Save&#39; button. A command is issued containing the aggregate id and activation date and ends up in the handler for the command where a unit of work is started. The Account <em>aggregate root</em> is loaded and the command handed to the aggregate to process. Internally the status and activation date are set. So only the part that has been altered now needs to be saved. Should another user have updated the banking details it really doesn&#39;t matter since the two <em>tasks</em> do not interfere with one another.</p><h3 id="applying-policy-rules" tabindex="-1">Applying policy rules <a class="header-anchor" href="#applying-policy-rules" aria-label="Permalink to &quot;Applying policy rules&quot;">​</a></h3><p>Why not just persist the command directly, bypassing the aggregate root?</p><p>In order to keep the aggregate valid the command is applied to the AR and it can then ensure that it is valid, or you can pass it through some validation mechanism. The act of applying the command may change the internal state to something that results in the validity being compromised. Applying the changes externally would be unwise.</p><h3 id="persisting-the-result" tabindex="-1">Persisting the result <a class="header-anchor" href="#persisting-the-result" aria-label="Permalink to &quot;Persisting the result&quot;">​</a></h3><p>Now the thing is that I don&#39;t currently fancy any ORM technology. An ORM, though, would do the change tracking for your AR and upon committing the unit of work the relevant changes would be persisted. However, when dealing directly with your own repository implementation I guess we&#39;ll require something like an ActivateAccount method on the repository to persist the relevant portions.</p><h3 id="not-all-conflicts-go-away" tabindex="-1">Not all conflicts go away <a class="header-anchor" href="#not-all-conflicts-go-away" aria-label="Permalink to &quot;Not all conflicts go away&quot;">​</a></h3><p>Although focusing on tasks may achieve some manner of isolation (since business folks don&#39;t typically perform the same tasks on the same entities) it may still be possible that two tasks alter common data. In such cases a concurrency-checking scheme such as a version number may still be required. <a href="http://codebetter.com/blogs/gregyoung/">Greg Young</a> has mentioned something along the lines of saving the commands and then finding those that have been applied against the version number of the command currently being processed. So if CommandA completed against version 1 then the version number increased to 2. Now we also started CommandB against version 1 but how do we know whether we have a conflict? The answer is to find the commands issued against our aggregate with version 1 and ask each if the current command conflicts with it. Something like:</p><div class="language-c# vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> conflict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">previousCommands.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ForEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">command</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { conflict </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> thisCommand.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ConflictsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(command); }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">if (!conflict)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// do stuff</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div></div><footer class="text-sm font-medium leading-5 divide-y divide-gray-200 dark:divide-slate-200/5 xl:col-start-1 xl:row-start-2"><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500 dark:text-white"> Next Article </h2><div class="link"><a href="/articles/2009-09-29-aggregate-roots-with-a-collection-of-another-ar.html">Aggregate Roots with a collection of another AR</a></div></div><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500 dark:text-white"> Previous Article </h2><div class="link"><a href="/articles/2009-09-09-many-to-many-aggregate-roots.html">Many-to-Many Aggregate Roots</a></div></div><div class="pt-8"><a class="link" href="/">← Back to the blog</a></div></footer></div></article></main></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"articles_2009-09-09-many-to-many-aggregate-roots.md\":\"B9BaxTFR\",\"articles_2010-08-19-natrual-aggregates-vs-synthetic-aggregates.md\":\"C0r0ouZr\",\"articles_2009-09-29-aggregate-roots-with-a-collection-of-another-ar.md\":\"B3Bot7Up\",\"articles_2009-09-08-aggregate-roots-as-self-contained-units.md\":\"B1Pufq1G\",\"articles_2015-03-31-overtime.md\":\"BbkAZYq1\",\"articles_2010-02-07-i-cannot-know-what-i-do-not-know.md\":\"BJsgXQZM\",\"articles_2010-12-05-soa-is-not-going-away.md\":\"BEWHOJ1H\",\"index.md\":\"DoHeZc-w\",\"articles_2010-10-28-behavioural-coupling.md\":\"BHxr2-Yx\",\"articles_2009-10-16-domain-events-orm-(or-lack-thereof).md\":\"CM1EW8i9\",\"articles_2010-01-22-applying-cqrs.md\":\"DR_4jOLe\",\"articles_2009-09-03-data-coupling.md\":\"WfblpE34\",\"articles_2010-04-08-there-is-an-aggregate-root-in-my-soup!.md\":\"B6dHMo3n\",\"articles_2025-04-17-no-low-code.md\":\"_UETBBQ8\",\"articles_2010-11-04-bite-size-chunks.md\":\"BH2ibLDO\",\"articles_2010-05-27-silo-where-are-you!.md\":\"B_upsXvQ\",\"articles_2025-05-04-ai-in-music.md\":\"CJCZI9GJ\",\"articles_2014-10-08-why-we-stopped-using-signalr.md\":\"CU5DiV0u\",\"articles_2010-05-28-wcf-and-stuff.md\":\"CKVDpL3V\",\"articles_2009-10-17-ordertotal()-cqs-meyer-and-object-semantics.md\":\"9ayopWpn\",\"articles_2024-06-04-ai-narrative.md\":\"C9Vrher1\",\"articles_2017-01-01-art-music-and-programming.md\":\"BaFOTIgd\",\"articles_2024-08-03-electric-dreams.md\":\"DMWaTn_w\",\"articles_2009-09-22-task-based-interaction.md\":\"DqEgMml9\",\"articles_2010-08-18-entity-vs-value-object.md\":\"DSmllqqv\",\"articles_2010-07-27-aggregate-roots-vs-single-responsibility.md\":\"DD3SqKZr\",\"articles_2016-12-19-uncle-bob-future-of-programming.md\":\"Bo1Rasa2\",\"articles_2010-02-11-why-i-think-software-projects-fail.md\":\"CJyP6F4m\",\"articles_2009-11-23-ddd-not-equal-to-ar.md\":\"COjUpUZe\",\"articles_2016-07-09-js-modules-for-cs-developers.md\":\"CQMZ2Xvt\",\"books_hard-edges.md\":\"CKACsUpt\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Eben Roux\",\"description\":\"All in a golden afternoon\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Examples\",\"link\":\"/markdown-examples\"}],\"sidebar\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Markdown Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"Runtime API Examples\",\"link\":\"/api-examples\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>