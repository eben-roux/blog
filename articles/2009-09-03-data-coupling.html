<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Temporal Data Coupling | Eben Roux</title>
    <meta name="description" content="All in a golden afternoon">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.C342PWRM.css" as="style">
    
    <script type="module" src="/assets/app.C0wh3tFo.js"></script>
    <link rel="modulepreload" href="/assets/chunks/theme.A64V9x26.js">
    <link rel="modulepreload" href="/assets/chunks/framework.B9tkazSO.js">
    <link rel="modulepreload" href="/assets/articles_2009-09-03-data-coupling.md.WfblpE34.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="antialiased dark:bg-slate-900"><div class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><nav class="flex justify-between items-center py-10 font-bold"><a class="text-xl" href="/" aria-label="The Vue Point"><img class="inline-block mr-2 w-10 h-10 rounded-full" alt="logo" src="https://www.gravatar.com/avatar/b7e03f86009c412446cfa81cbe5c000009ffb67ec7585806aee387294e27d023?s=80&amp;d=identicon"><span class="hidden md:inline dark:text-white">Eben Roux</span></a><div class="text-sm text-gray-500 dark:text-white leading-5 flex items-center"><a class="hover:text-gray-700 dark:hover:text-gray-200" href="/books/hard-edges" rel="noopener">Hard Edges</a><span class="mr-2 ml-2">¬∑</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://www.pendel.co.za/" target="_blank" rel="noopener">Shuttle</a><span class="mr-2 ml-2">¬∑</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="/Eben Roux - Resume.pdf" target="_blank" rel="noopener">Resume</a><span class="mr-2 ml-2">¬∑</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://discord.gg/QypKQP4ABq" target="_blank" rel="noopener"><svg class="fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 146 146"><title>Discord</title><path d="M107.75 125.001s-4.5-5.375-8.25-10.125c16.375-4.625 22.625-14.875 22.625-14.875-5.125 3.375-10 5.75-14.375 7.375-6.25 2.625-12.25 4.375-18.125 5.375-12 2.25-23 1.625-32.375-.125-7.125-1.375-13.25-3.375-18.375-5.375-2.875-1.125-6-2.5-9.125-4.25-.375-.25-.75-.375-1.125-.625-.25-.125-.375-.25-.5-.375-2.25-1.25-3.5-2.125-3.5-2.125s6 10 21.875 14.75c-3.75 4.75-8.375 10.375-8.375 10.375-27.625-.875-38.125-19-38.125-19 0-40.25 18-72.875 18-72.875 18-13.5 35.125-13.125 35.125-13.125l1.25 1.5c-22.5 6.5-32.875 16.375-32.875 16.375s2.75-1.5 7.375-3.625c13.375-5.875 24-7.5 28.375-7.875.75-.125 1.375-.25 2.125-.25 7.625-1 16.25-1.25 25.25-.25 11.875 1.375 24.625 4.875 37.625 12 0 0-9.875-9.375-31.125-15.875l1.75-2S110 19.626 128 33.126c0 0 18 32.625 18 72.875 0 0-10.625 18.125-38.25 19zM49.625 66.626c-7.125 0-12.75 6.25-12.75 13.875s5.75 13.875 12.75 13.875c7.125 0 12.75-6.25 12.75-13.875.125-7.625-5.625-13.875-12.75-13.875zm45.625 0c-7.125 0-12.75 6.25-12.75 13.875s5.75 13.875 12.75 13.875c7.125 0 12.75-6.25 12.75-13.875s-5.625-13.875-12.75-13.875z" fill-rule="nonzero"></path></svg></a><span class="mr-2"></span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://github.com/eben-roux/blog" target="_blank" rel="noopener"><svg class="inline fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>GitHub</title><path d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"></path></svg></a></div></nav></div><main class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><article class="xl:divide-y xl:divide-gray-200 dark:xl:divide-slate-200/5"><header class="pt-6 xl:pb-10 space-y-1 text-center"><dl><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-500 dark:text-gray-300"><time datetime="2009-09-03T12:00:00.000Z">September 3, 2009</time></dd></dl><h1 class="text-3xl leading-9 font-extrabold text-gray-900 dark:text-white tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Temporal Data Coupling</h1></header><div class="divide-y xl:divide-y-0 divide-gray-200 dark:divide-slate-200/5 xl:grid xl:grid-cols-4 xl:gap-x-10 pb-16 xl:pb-20" style="grid-template-rows:auto 1fr;"><!----><div class="divide-y divide-gray-200 dark:divide-slate-200/5 xl:pb-0 xl:col-span-3 xl:row-span-2"><div style="position:relative;" class="prose dark:prose-invert max-w-none pt-10 pb-8"><div><p>I spent some time this past weekend thinking about how the object-oriented development community has done its utmost to rid itself of high coupling within object models. It has, for the most part, been rather successful.</p><hr><p>I got to thinking how there appears to be a high level of coupling when it comes to the actual data being stored; resulting in coupling within the database structure. If one considers that a customer may be invoiced then an Invoice has a direct relationship to a Customer; hence, the customer foreign key resides in the invoice. This tightly couples the data. It means that we now absolutely have to have a customer for an invoice. In a real sense it is probably true. Although, since we could capture an invoice as a cash sale (for whatever reason) we may not have a real customer. Be that as it may, we always need to store some form of a customer.</p><p>Where is the tight coupling? I think it turns out to be not so much within the structure but rather it has to do with the temporal nature of the data within the model. Add to this the fact that we have transactional data (Domain / Command) and &#39;analytical&#39; data (Reporting / Query) then it becomes quite hectic.</p><h3 id="object-state-vs-object-type-vs-object-lifetime" tabindex="-1">Object State vs. Object Type vs. Object Lifetime <a class="header-anchor" href="#object-state-vs-object-type-vs-object-lifetime" aria-label="Permalink to &quot;Object State vs. Object Type vs. Object Lifetime&quot;">‚Äã</a></h3><p>The objects within our broader domain change as time goes by. Now these changes need to be handled correctly; it may be quite easy to use the <em>state</em> pattern incorrectly. The archetypal sample of this pattern is the vending machine. As actions take place within the machine so the state transitions occur. The vending machine however, stays a vending machine.</p><p>Now how about an egg? Is it a chicken in another state? Let&#39;s say we want to track all our eggs. Each gets a number. Then one day egg number 1 &#39;dies&#39;. Do we care about the egg? How about the cost of getting the egg to the point it was before it &#39;died&#39;? The next day egg number 2 hatches. Do we care about this egg? It no longer exists. We do care about chicken number 1, though. But after six weeks chicken number one becomes roast chicken number 20. The chicken is gone.</p><p>This is where CQS (Architecture) comes in. In our transaction store we could start with the two eggs and track all the required information and reporting data in the reporting store. Once egg number 1 dies we can remove it from the transaction store. All the historical data remains in the reporting store. However, the <em>state</em> of that egg has probably changed to &#39;dead&#39;, though. The same goes for egg number 2. It&#39;s state changed to &#39;hatched&#39;; but suddenly we now have a chicken added to our chicken repository. Once the chicken is roasted we can remove the chicken from our checking repository in the transactional store since all the audit data is still in the query store and the chicken is, well, history. But now we have an extra item added to the RoastedChickenRepository.</p><p>The same idea goes for a Quote leading to an Order leading to an Invoice leading a PaymentReceivedTransaction; each living and dying as it transitions along the path. It has a lifetime in our transaction store. The reporting store, however, never forgets and is the keeper of all things good and bad that happened.</p><h3 id="now-the-coupling" tabindex="-1">Now the coupling <a class="header-anchor" href="#now-the-coupling" aria-label="Permalink to &quot;Now the coupling&quot;">‚Äã</a></h3><p>Let&#39;s say we have a &#39;LastQuote&#39; on our Customer class. Since our domain model represents our transactional store, <em>that</em> reference is only valid while the quote is actually &#39;alive&#39;. Once it becomes an Order or the quote is rejected we no longer have a &#39;LastQuote&#39;. What do we do?</p><p>One option is to simply set LastQuote to null when the quote is deleted; if the last quote actually refers to the quote being deleted. Now this is where the <a title="Don&#39;t Delete - Just Don&#39;t" href="https://udidahan.com/2009/09/01/dont-delete-just-dont/">Don&#39;t Delete - Just Don&#39;t</a> thinking probably does not apply since deleting from the domain store may just be OK. Maybe I&#39;m off-track but I&#39;m sure someone will let me know üòÉ</p><p>Another option is not to model it like this in the first place but to rather use an application service to return whatever data we need from the last quote, from the query store. Something like <code>QuoteService.LastQuoteDataForCustomer(123)</code>.</p></div></div></div><footer class="text-sm font-medium leading-5 divide-y divide-gray-200 dark:divide-slate-200/5 xl:col-start-1 xl:row-start-2"><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500 dark:text-white"> Next Article </h2><div class="link"><a href="/articles/2009-09-08-aggregate-roots-as-self-contained-units.html">Aggregate Roots as self-contained units</a></div></div><!----><div class="pt-8"><a class="link" href="/">‚Üê Back to the blog</a></div></footer></div></article></main></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"articles_2010-01-22-applying-cqrs.md\":\"DR_4jOLe\",\"articles_2015-03-31-overtime.md\":\"BbkAZYq1\",\"articles_2010-11-04-bite-size-chunks.md\":\"BH2ibLDO\",\"articles_2010-10-28-behavioural-coupling.md\":\"BHxr2-Yx\",\"articles_2009-10-16-domain-events-orm-(or-lack-thereof).md\":\"CM1EW8i9\",\"articles_2010-02-07-i-cannot-know-what-i-do-not-know.md\":\"BJsgXQZM\",\"articles_2009-09-29-aggregate-roots-with-a-collection-of-another-ar.md\":\"B3Bot7Up\",\"articles_2009-10-17-ordertotal()-cqs-meyer-and-object-semantics.md\":\"9ayopWpn\",\"articles_2010-05-27-silo-where-are-you!.md\":\"B_upsXvQ\",\"articles_2009-09-09-many-to-many-aggregate-roots.md\":\"B9BaxTFR\",\"articles_2010-04-08-there-is-an-aggregate-root-in-my-soup!.md\":\"B6dHMo3n\",\"articles_2010-05-28-wcf-and-stuff.md\":\"CKVDpL3V\",\"articles_2014-10-08-why-we-stopped-using-signalr.md\":\"CU5DiV0u\",\"articles_2009-09-03-data-coupling.md\":\"WfblpE34\",\"articles_2010-08-19-natrual-aggregates-vs-synthetic-aggregates.md\":\"C0r0ouZr\",\"articles_2010-02-11-why-i-think-software-projects-fail.md\":\"CJyP6F4m\",\"articles_2010-08-18-entity-vs-value-object.md\":\"DSmllqqv\",\"articles_2016-12-19-uncle-bob-future-of-programming.md\":\"Bo1Rasa2\",\"articles_2025-04-17-no-low-code.md\":\"_UETBBQ8\",\"articles_2024-06-04-ai-narrative.md\":\"C9Vrher1\",\"articles_2009-09-08-aggregate-roots-as-self-contained-units.md\":\"B1Pufq1G\",\"articles_2017-01-01-art-music-and-programming.md\":\"BaFOTIgd\",\"articles_2010-07-27-aggregate-roots-vs-single-responsibility.md\":\"DD3SqKZr\",\"index.md\":\"DoHeZc-w\",\"articles_2010-12-05-soa-is-not-going-away.md\":\"BEWHOJ1H\",\"articles_2009-09-22-task-based-interaction.md\":\"DqEgMml9\",\"articles_2009-11-23-ddd-not-equal-to-ar.md\":\"COjUpUZe\",\"articles_2024-08-03-electric-dreams.md\":\"DMWaTn_w\",\"articles_2016-07-09-js-modules-for-cs-developers.md\":\"CQMZ2Xvt\",\"books_hard-edges.md\":\"BFa8jzQw\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Eben Roux\",\"description\":\"All in a golden afternoon\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Examples\",\"link\":\"/markdown-examples\"}],\"sidebar\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Markdown Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"Runtime API Examples\",\"link\":\"/api-examples\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>