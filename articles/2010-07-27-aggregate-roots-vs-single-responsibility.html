<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Aggregate Roots vs. Single Responsibility (and other issues) | Eben Roux</title>
    <meta name="description" content="All in a golden afternoon">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.C342PWRM.css" as="style">
    
    <script type="module" src="/assets/app.Bqr9e_wV.js"></script>
    <link rel="modulepreload" href="/assets/chunks/theme.DA1ScVb5.js">
    <link rel="modulepreload" href="/assets/chunks/framework.B9tkazSO.js">
    <link rel="modulepreload" href="/assets/articles_2010-07-27-aggregate-roots-vs-single-responsibility.md.DD3SqKZr.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="antialiased dark:bg-slate-900"><div class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><nav class="flex justify-between items-center py-10 font-bold"><a class="text-xl" href="/" aria-label="The Vue Point"><img class="inline-block mr-2 w-10 h-10 rounded-full" alt="logo" src="https://www.gravatar.com/avatar/b7e03f86009c412446cfa81cbe5c000009ffb67ec7585806aee387294e27d023?s=80&amp;d=identicon"><span class="hidden md:inline dark:text-white">Eben Roux</span></a><div class="text-sm text-gray-500 dark:text-white leading-5 flex items-center"><a class="hover:text-gray-700 dark:hover:text-gray-200" href="/books/hard-edges" rel="noopener">Hard Edges</a><span class="mr-2 ml-2">·</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://www.pendel.co.za/" target="_blank" rel="noopener">Shuttle</a><span class="mr-2 ml-2">·</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="/Eben Roux - Resume.pdf" target="_blank" rel="noopener">Resume</a><span class="mr-2 ml-2">·</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://discord.gg/QypKQP4ABq" target="_blank" rel="noopener"><svg class="fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 146 146"><title>Discord</title><path d="M107.75 125.001s-4.5-5.375-8.25-10.125c16.375-4.625 22.625-14.875 22.625-14.875-5.125 3.375-10 5.75-14.375 7.375-6.25 2.625-12.25 4.375-18.125 5.375-12 2.25-23 1.625-32.375-.125-7.125-1.375-13.25-3.375-18.375-5.375-2.875-1.125-6-2.5-9.125-4.25-.375-.25-.75-.375-1.125-.625-.25-.125-.375-.25-.5-.375-2.25-1.25-3.5-2.125-3.5-2.125s6 10 21.875 14.75c-3.75 4.75-8.375 10.375-8.375 10.375-27.625-.875-38.125-19-38.125-19 0-40.25 18-72.875 18-72.875 18-13.5 35.125-13.125 35.125-13.125l1.25 1.5c-22.5 6.5-32.875 16.375-32.875 16.375s2.75-1.5 7.375-3.625c13.375-5.875 24-7.5 28.375-7.875.75-.125 1.375-.25 2.125-.25 7.625-1 16.25-1.25 25.25-.25 11.875 1.375 24.625 4.875 37.625 12 0 0-9.875-9.375-31.125-15.875l1.75-2S110 19.626 128 33.126c0 0 18 32.625 18 72.875 0 0-10.625 18.125-38.25 19zM49.625 66.626c-7.125 0-12.75 6.25-12.75 13.875s5.75 13.875 12.75 13.875c7.125 0 12.75-6.25 12.75-13.875.125-7.625-5.625-13.875-12.75-13.875zm45.625 0c-7.125 0-12.75 6.25-12.75 13.875s5.75 13.875 12.75 13.875c7.125 0 12.75-6.25 12.75-13.875s-5.625-13.875-12.75-13.875z" fill-rule="nonzero"></path></svg></a><span class="mr-2"></span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://github.com/eben-roux/blog" target="_blank" rel="noopener"><svg class="inline fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>GitHub</title><path d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"></path></svg></a></div></nav></div><main class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><article class="xl:divide-y xl:divide-gray-200 dark:xl:divide-slate-200/5"><header class="pt-6 xl:pb-10 space-y-1 text-center"><dl><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-500 dark:text-gray-300"><time datetime="2010-07-27T12:00:00.000Z">July 27, 2010</time></dd></dl><h1 class="text-3xl leading-9 font-extrabold text-gray-900 dark:text-white tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Aggregate Roots vs. Single Responsibility (and other issues)</h1></header><div class="divide-y xl:divide-y-0 divide-gray-200 dark:divide-slate-200/5 xl:grid xl:grid-cols-4 xl:gap-x-10 pb-16 xl:pb-20" style="grid-template-rows:auto 1fr;"><!----><div class="divide-y divide-gray-200 dark:divide-slate-200/5 xl:pb-0 xl:col-span-3 xl:row-span-2"><div style="position:relative;" class="prose dark:prose-invert max-w-none pt-10 pb-8"><div><p>It is interesting to note how many questions there are around Aggregate Roots. Every-so-often someone will post a question on the Yahoo Domain-Driven Design Group regarding how to structure the Aggregate Roots. Now, I may be no genius but there are too many such questions for my liking. It indicates that something is hard to understand; and when something is hard to understand it probably highlighting a larger problem.</p><p><em><strong>2024-05-11</strong></em>: Yahoo groups no longer exist.</p><hr><h3 id="aggregate-vs-aggregate-root" tabindex="-1">Aggregate vs. Aggregate Root <a class="header-anchor" href="#aggregate-vs-aggregate-root" aria-label="Permalink to &quot;Aggregate vs. Aggregate Root&quot;">​</a></h3><blockquote><p>&quot;Cluster ENTITIES and VALUE OBJECTS into AGGREGATES and define boundaries around each. Choose one ENTITY to be the root of the AGGREGATE, and control all access to the objects inside the boundary through the root.&quot; (Evans, p. 129)</p></blockquote><p>In one of Eric&#39;s presentations he touches on this; stating the difference between an Aggregate and an Aggregate Root. I have mentioned Eric&#39;s bunch of grapes example in a <a href="./2009-11-23-ddd-not-equal-to-ar.html">previous post</a> so I will not re-hash it here.</p><p>The gang of four has two principles of object-oriented design:</p><ul><li>&quot;Program to an interface, not an implementation.&quot; (Gamma <em>et. al.</em> p. 18)</li><li>&quot;Favor object composition over class inheritance.&quot; (Gamma <em>et. al.</em> p. 20)</li></ul><p>So what&#39;s the point? At first glance it seems that we are working with composition for both the Aggregate and the Aggregate Root. On page 128 of Eric&#39;s blue book there is a class diagram modelling a car. The car class is adorned with two stereotypes: <code>&lt;&lt;Entity&gt;&gt;</code> and <code>&lt;&lt;Aggregate Root&gt;&gt;</code>.</p><h4 id="single-responsibility" tabindex="-1">Single Responsibility? <a class="header-anchor" href="#single-responsibility" aria-label="Permalink to &quot;Single Responsibility?&quot;">​</a></h4><p>So is an Aggregate Root called Car sticking to the Single Responsibility Principle? It <em>is</em> responsible for Car behaviour; but also for the consistency within the Aggregate since it now represents an Aggregate with the Car entity as the Root. It seems as though the Car is doing more than it should and I think that this leads to many issues.</p><p>Could it be that the Car Aggregate Root concept is a specialisation of the Car entity? So, following this reasoning it is actually inheritance. The reason we do not see it is because it is flattened into the Car entity and, therefore, the car no longer adheres to SRP. My reasoning could be flawed so I am open to persuasion.</p><h3 id="does-the-aggregate-root-change-depending-on-the-use-case" tabindex="-1">Does the Aggregate Root change depending on the use case? <a class="header-anchor" href="#does-the-aggregate-root-change-depending-on-the-use-case" aria-label="Permalink to &quot;Does the Aggregate Root change depending on the use case?&quot;">​</a></h3><p>The problem the <code>Aggregate Root</code> concept is trying to solve is <em>consistency</em>. It groups objects together to ensure that they are used as a unit. When one looks at the philosophy behind <a href="http://www.artima.com/articles/dci_vision.html" target="_blank" rel="noreferrer">Data-Context-Interaction (DCI)</a> it appears as though the context is pushed into the root entity. When a different context (use-case) enters the fray that also makes use of the same <code>Aggregate Root</code> it appears as though the <code>Aggregate Root</code> is changing.</p><p>There <em>has</em> been some discussion around the issue of the <code>Aggregate Root</code> <em>changing</em> depending on the use case, i.e. a different entity is regarded as the root depending on the use case. Now some folks state that the <code>Aggregate Root</code> isn&#39;t really changing but the fact that it <em>appears</em> to be changing should be an indication that you are working with different <strong>Bounded Context</strong>. Now this is probably true; especially since the word <strong>context</strong> make an appearance.</p><h4 id="a-quick-note-on-bounded-contexts" tabindex="-1">A quick note on Bounded Contexts <a class="header-anchor" href="#a-quick-note-on-bounded-contexts" aria-label="Permalink to &quot;A quick note on Bounded Contexts&quot;">​</a></h4><p>Let&#39;s stay with the Car example. Let&#39;s say we have a car rental company and we have our own workshop. Now our car could do something along the lines of <code>Car.ScheduleMaintenance(_dependencies)</code> and <code>Car.MakeBooking(_dependencies)</code>.</p><p>This is where issues start creeping into the design. The maintenance management folks don&#39;t give two hoots about rentals and, likewise, the rental folks are not too interested in maintenance; they only want to know whether the car is available for rental. Enter the Bounded Context (<strong>BC</strong>). We have a <strong>Maintenance Management BC</strong> and <strong>Rental Administration BC</strong>. Of course we would probably also need a <strong>Fleet Management BC</strong> with e.g <code>Car.Commission()</code> and <code>Car.Decommission()</code>.</p><p>The particular Car is the same car in the real world. Just look at the registration number. However, the context within which it is used changes. It is, in OO terms, a specialization of a Car class to incorporate the context. This inevitably leads to data duplication of sorts since the data for each BC will probably be stored in different databases.</p><p>Assuming we view this as a problem, how could we solve this? As proposed by the GoF we could try composition. In DCI terms the context can aggregate the different entities. I previously blogged about an <a href="./2009-11-23-ddd-not-equal-to-ar.html#aneamic-use-case-model">aneamic use-case model</a> and the context looks an awful lot like a use-case. I have not played around with how to get these concepts into code but we&#39;ll get there.</p><h3 id="repositories-return-aggregate-roots" tabindex="-1">Repositories return Aggregate Roots? <a class="header-anchor" href="#repositories-return-aggregate-roots" aria-label="Permalink to &quot;Repositories return Aggregate Roots?&quot;">​</a></h3><p>Now this one is rather weird. I have no idea where this comes from. For those that have the Domain-Driven Design book by Eric Evans it is a simple case of opening the front cover and having a look at the diagram printed on the inside where it clearly shows two arrows that point to <strong>Repositories</strong>. One comes from <strong>Entities</strong> and the other from <strong>Aggregates</strong> (note: not Aggregate Root), like so:</p><ul><li>[Entities] --- <em>access</em> with --&gt; [Repositories]</li><li>[Aggregates] --- <em>access</em> with --&gt; [Repositories]</li></ul><p>The fact is that a repository <strong>always</strong> returns an entity whether or not that entity is an aggregate. So if folks want to call it an AR when there is no aggregation it probably will not restrict the design.</p></div></div></div><footer class="text-sm font-medium leading-5 divide-y divide-gray-200 dark:divide-slate-200/5 xl:col-start-1 xl:row-start-2"><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500 dark:text-white"> Next Article </h2><div class="link"><a href="/articles/2010-08-18-entity-vs-value-object.html">Entity vs. Value Object</a></div></div><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500 dark:text-white"> Previous Article </h2><div class="link"><a href="/articles/2010-05-28-wcf-and-stuff.html">WCF issues</a></div></div><div class="pt-8"><a class="link" href="/">← Back to the blog</a></div></footer></div></article></main></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"articles_2010-08-19-natrual-aggregates-vs-synthetic-aggregates.md\":\"C0r0ouZr\",\"articles_2009-10-16-domain-events-orm-(or-lack-thereof).md\":\"CM1EW8i9\",\"articles_2010-05-27-silo-where-are-you!.md\":\"B_upsXvQ\",\"articles_2014-10-08-why-we-stopped-using-signalr.md\":\"CU5DiV0u\",\"articles_2010-02-07-i-cannot-know-what-i-do-not-know.md\":\"BJsgXQZM\",\"articles_2009-09-29-aggregate-roots-with-a-collection-of-another-ar.md\":\"B3Bot7Up\",\"articles_2009-10-17-ordertotal()-cqs-meyer-and-object-semantics.md\":\"9ayopWpn\",\"articles_2010-10-28-behavioural-coupling.md\":\"BHxr2-Yx\",\"articles_2010-12-05-soa-is-not-going-away.md\":\"BEWHOJ1H\",\"articles_2009-09-08-aggregate-roots-as-self-contained-units.md\":\"B1Pufq1G\",\"articles_2010-04-08-there-is-an-aggregate-root-in-my-soup!.md\":\"B6dHMo3n\",\"articles_2010-01-22-applying-cqrs.md\":\"DR_4jOLe\",\"articles_2009-09-09-many-to-many-aggregate-roots.md\":\"B9BaxTFR\",\"articles_2010-11-04-bite-size-chunks.md\":\"BH2ibLDO\",\"articles_2010-07-27-aggregate-roots-vs-single-responsibility.md\":\"DD3SqKZr\",\"articles_2010-05-28-wcf-and-stuff.md\":\"CKVDpL3V\",\"articles_2010-02-11-why-i-think-software-projects-fail.md\":\"CJyP6F4m\",\"articles_2024-06-04-ai-narrative.md\":\"C9Vrher1\",\"articles_2010-08-18-entity-vs-value-object.md\":\"DSmllqqv\",\"articles_2015-03-31-overtime.md\":\"BbkAZYq1\",\"articles_2009-09-03-data-coupling.md\":\"WfblpE34\",\"articles_2025-04-17-no-low-code.md\":\"_UETBBQ8\",\"articles_2025-05-04-ai-in-music.md\":\"CJCZI9GJ\",\"articles_2016-12-19-uncle-bob-future-of-programming.md\":\"Bo1Rasa2\",\"articles_2009-11-23-ddd-not-equal-to-ar.md\":\"COjUpUZe\",\"articles_2024-08-03-electric-dreams.md\":\"DMWaTn_w\",\"index.md\":\"DoHeZc-w\",\"articles_2009-09-22-task-based-interaction.md\":\"DqEgMml9\",\"articles_2017-01-01-art-music-and-programming.md\":\"BaFOTIgd\",\"articles_2016-07-09-js-modules-for-cs-developers.md\":\"CQMZ2Xvt\",\"books_hard-edges.md\":\"BFa8jzQw\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Eben Roux\",\"description\":\"All in a golden afternoon\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Examples\",\"link\":\"/markdown-examples\"}],\"sidebar\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Markdown Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"Runtime API Examples\",\"link\":\"/api-examples\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>